---
title: "Ingest and Transform"
output: html_notebook
---

```{r}
source('../utils.R')
library(stats)
library(data.table)

old_mecovi <- readxl::read_excel("../data/Inventario_Mecovi.xlsx",
                           sheet = "Inventario_Mecovi", skip = 2)

# Load New Dict
dic <- readxl::read_excel("../data/metadata_dataset_level.xlsx",
                           sheet = 1) %>% 
    drop_na(Final.Mecovi.2.0)

# Rename
aux <- dic  %>% 
  dplyr::select(Mecovi, Final.Mecovi.2.0) %>% 
  drop_na(Final.Mecovi.2.0) %>% 
  drop_na()

rename_names <- as.character(aux$Final.Mecovi.2.0)
names(rename_names) <- aux$Mecovi
setnames(old_mecovi, old=colnames(old_mecovi[,names(rename_names)]) , 
         new=unname(rename_names))

```



```{r}
# Recode
old_mecovi$gYear <- as.numeric(old_mecovi$gYear)
old_mecovi$intHogs <- as.numeric(old_mecovi$intHogs)
old_mecovi$intPers <- as.numeric(old_mecovi$intPers)

# Add new Variables
diffnames <- dic %>% drop_na(Final.Mecovi.2.0) %>% 
  select(Final.Mecovi.2.0) %>% 
  pull() %>% setdiff(colnames(old_mecovi))
old_mecovi[,diffnames]<-NA

# Preprocessing

# Reorder
old_mecovi %>% select(dic$Final.Mecovi.2.0) %>%
  drop_na(idCountry, gYear) %>% 
  writexl::write_xlsx("../data/metadata_scl.xlsx")
```



